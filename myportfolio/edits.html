<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Design Poster Gallery</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Bootstrap 5 JS (with Popper.js) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Fabric.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.1/fabric.min.js"></script>
    <!-- Google Fonts: Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
        }
        #canvas-container {
            width: 100vw;
            height: 100vh;
            overflow: auto;
            margin: 0;
            padding: 0;
        }
        .toolbox-drawer {
            position: fixed;
            top: 4.5rem;
            right: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-left: 1px solid rgba(203, 213, 225, 0.6);
            border-bottom: 1px solid rgba(203, 213, 225, 0.6);
            border-radius: 0 0 0 12px;
            box-shadow: -4px 4px 12px rgba(0, 0, 0, 0.15);
            display: none;
            flex-direction: column;
            gap: 1.25rem;
            z-index: 1050;
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .toolbox-drawer.active {
            display: flex;
            transform: translateX(0);
        }
        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: #1e293b;
        }
        .btn-teal {
            background-color: #0f766e;
            border-color: #0f766e;
            color: #fff;
        }
        .btn-teal:hover {
            background-color: #115e59;
            border-color: #115e59;
            color: #fff;
        }
        .form-check-input:checked {
            background-color: #0f766e;
            border-color: #0f766e;
        }
        .form-check-input:focus {
            box-shadow: 0 0 0 0.25rem rgba(15, 118, 110, 0.25);
        }
        .zoom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #0f766e;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        .zoom-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #0f766e;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.2s ease;
        }
        .zoom-slider::-webkit-slider-thumb:hover {
            background: #115e59;
        }
        .zoom-slider::-moz-range-thumb:hover {
            background: #115e59;
        }
        .polaroid-frame {
            background: #fff;
            padding: 12px 12px 40px 12px;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            position: relative;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .polaroid-frame::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 24px;
            height: 24px;
            background: linear-gradient(45deg, #d4d4d4, #e5e5e5);
            clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
            opacity: 0.8;
            z-index: 1;
        }
    </style>
</head>
<body>
    <header class="bg-dark text-white py-3 shadow">
        <div class="container d-flex justify-content-between align-items-center">
            <h1 class="h5 mb-0 fw-semibold">Design Poster Gallery</h1>
            <button onclick="toggleToolbox()" class="btn btn-teal">üõ†Ô∏è Tools</button>
        </div>
    </header>
    <div id="canvas-container">
        <canvas id="canvas" width="1200" height="800"></canvas>
    </div>
    <div class="toolbox-drawer" id="toolboxDrawer">
        <div class="drawer-header">
            <span>üé¨ Director Tools</span>
            <button onclick="toggleToolbox()" class="btn btn-link text-secondary p-0">‚úñ</button>
        </div>
        <div class="d-flex gap-2">
            <button onclick="shuffleLayout()" class="btn btn-teal">üîÄ Shuffle</button>
            <button onclick="resetLayout()" class="btn btn-teal">‚Ü©Ô∏è Reset</button>
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="snapToggle" onchange="toggleSnap()">
            <label class="form-check-label text-secondary" for="snapToggle">
                Snap to Grid
            </label>
        </div>
        <div>
            <label for="zoomSlider" class="form-label text-secondary">Zoom</label>
            <input type="range" min="0.5" max="1.5" step="0.1" value="1" id="zoomSlider" class="zoom-slider form-range" oninput="zoomBoard(this.value)">
        </div>
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="darkroomToggle" onchange="toggleDarkroom()">
            <label class="form-check-label text-secondary" for="darkroomToggle">
                üé• Darkroom Mode
            </label>
        </div>
    </div>

    <script>
        // Initialize Fabric.js canvas
        const canvas = new fabric.Canvas('canvas', {
            selection: false
        });

        // Set canvas background image
        fabric.Image.fromURL('https://ik.imagekit.io/usr1sai/download.jpeg?updatedAt=1758782358324', (img) => {
            canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
                scaleX: canvas.width / img.width,
                scaleY: canvas.height / img.height
            });
        });

        // Placeholder poster images
        const posterUrls = [
            'https://ik.imagekit.io/usr1sai/Firestorm.png?updatedAt=1758811712659',
            'https://ik.imagekit.io/usr1sai/Mahaveerudu.jpg?updatedAt=1758811681852',
            'https://ik.imagekit.io/usr1sai/DC.png?updatedAt=1758811725524',
            'https://ik.imagekit.io/usr1sai/No%20Tension%20Baby.png?updatedAt=1758811639448',
            'https://ik.imagekit.io/usr1sai/Its%20Omi.jpg?updatedAt=1758811701368'
        ];

        // Store initial positions and rotations for reset
        const initialStates = [];
        let snapToGrid = false;
        let activeZIndex = 10;
        const standardPosterWidth = 300;
        const standardPosterHeight = 400;

        // Load posters with polaroid effect
        posterUrls.forEach((url, index) => {
            fabric.Image.fromURL(url, (img) => {
                // Calculate scale to fit standard size while preserving aspect ratio
                const aspectRatio = img.width / img.height;
                let scaleX, scaleY;
                if (aspectRatio > standardPosterWidth / standardPosterHeight) {
                    // Image is wider, fit to height
                    scaleY = standardPosterHeight / img.height;
                    scaleX = scaleY;
                } else {
                    // Image is taller or equal, fit to width
                    scaleX = standardPosterWidth / img.width;
                    scaleY = scaleX;
                }

                // Random rotation between -5 and 5 degrees
                const rotation = Math.random() * 10 - 5;
                // Create a group with polaroid frame
                const frame = new fabric.Rect({
                    width: standardPosterWidth + 24,
                    height: standardPosterHeight + 52,
                    fill: '#fff',
                    stroke: 'linear-gradient(45deg, #e5e5e5, #f5f5f5)',
                    strokeWidth: 2,
                    rx: 12,
                    ry: 12,
                    shadow: '0 6px 12px rgba(0,0,0,0.3)',
                    originX: 'center',
                    originY: 'center'
                });
                img.set({
                    left: 0,
                    top: -14,
                    originX: 'center',
                    originY: 'center',
                    scaleX: scaleX,
                    scaleY: scaleY
                });
                const group = new fabric.Group([frame, img], {
                    left: 100 + (index % 4) * 350,
                    top: index < 4 ? 100 : 100 + standardPosterHeight * 0.7 + 50,
                    scaleX: 0.7,
                    scaleY: 0.7,
                    angle: rotation,
                    selectable: true,
                    hasControls: false,
                    subTargetCheck: true
                });
                initialStates.push({ left: group.left, top: group.top, angle: rotation });
                canvas.add(group);

                // Bring to front on drag start
                group.on('mousedown', () => {
                    group.set('zIndex', activeZIndex++);
                    canvas.renderAll();
                });
            });
        });

        // Toggle toolbox visibility
        function toggleToolbox() {
            document.getElementById('toolboxDrawer').classList.toggle('active');
        }

        // Shuffle poster positions and rotations
        function shuffleLayout() {
            canvas.forEachObject((obj, index) => {
                const maxX = canvas.getWidth() - obj.getScaledWidth();
                const maxY = canvas.getHeight() - obj.getScaledHeight();
                const newRotation = Math.random() * 10 - 5;
                const minTop = index < 4 ? 100 : 100 + standardPosterHeight * 0.7 + 50; // Ensure fifth poster is in second row
                obj.set({
                    left: Math.random() * maxX,
                    top: index < 4 ? Math.random() * (maxY - 100) + 100 : Math.random() * (maxY - minTop) + minTop,
                    angle: newRotation
                });
                if (snapToGrid) {
                    obj.set({
                        left: Math.round(obj.left / 50) * 50,
                        top: Math.round(obj.top / 50) * 50
                    });
                }
            });
            canvas.renderAll();
        }

        // Reset poster positions and rotations
        function resetLayout() {
            canvas.forEachObject((obj, index) => {
                obj.set({
                    left: initialStates[index].left,
                    top: initialStates[index].top,
                    angle: initialStates[index].angle
                });
            });
            canvas.setZoom(1);
            document.getElementById('zoomSlider').value = 1;
            canvas.renderAll();
        }

        // Toggle snap to grid
        function toggleSnap() {
            snapToGrid = document.getElementById('snapToggle').checked;
        }

        // Snap to grid on drag
        canvas.on('object:moving', (e) => {
            if (snapToGrid) {
                e.target.set({
                    left: Math.round(e.target.left / 50) * 50,
                    top: Math.round(e.target.top / 50) * 50
                });
            }
        });

        // Zoom canvas
        function zoomBoard(value) {
            canvas.setZoom(value);
            canvas.renderAll();
        }

        // Toggle darkroom mode
        function toggleDarkroom() {
            const isDark = document.getElementById('darkroomToggle').checked;
            if (isDark) {
                canvas.setBackgroundImage(null, canvas.renderAll.bind(canvas));
                canvas.setBackgroundColor('#0f172a');
            } else {
                fabric.Image.fromURL('https://ik.imagekit.io/usr1sai/download.jpeg?updatedAt=1758782358324', (img) => {
                    canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas), {
                        scaleX: canvas.width / img.width,
                        scaleY: canvas.height / img.height
                    });
                });
            }
            canvas.renderAll();
        }

        // Ensure canvas resizes with window
        window.addEventListener('resize', () => {
            canvas.setWidth(window.innerWidth);
            canvas.setHeight(window.innerHeight);
            if (canvas.backgroundImage) {
                canvas.setBackgroundImage(canvas.backgroundImage, canvas.renderAll.bind(canvas), {
                    scaleX: canvas.width / canvas.backgroundImage.width,
                    scaleY: canvas.height / canvas.backgroundImage.height
                });
            }
            // Reposition posters to maintain initial layout
            canvas.forEachObject((obj, index) => {
                obj.set({
                    left: 100 + (index % 4) * 350,
                    top: index < 4 ? 100 : 100 + standardPosterHeight * 0.7 + 50
                });
            });
            canvas.renderAll();
        });

        // Trigger initial resize
        canvas.setWidth(window.innerWidth);
        canvas.setHeight(window.innerHeight);
    </script>
</body>
</html>